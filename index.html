<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Space Drifters Â· Index</title>
    <script src='./scripts/util/prototype.js'></script>
    <script src='./scripts/util/vector.js'></script>
    <script src='./scripts/effect/particles.js'></script>
    <script src='./scripts/ui/ui.js'></script>
    <script src='./scripts/engine.js'></script>
    <link rel='stylesheet' href='./style/stylesheet.css'>
    <link rel='stylesheet' href='./style/popup.css'>
  </head>
  <body>
    <header>
      <canvas id='canvas'></canvas>
      <h1>Space Drifters</h1>
    </header>
    <main>
      <button type="button" onclick="dispModal()" name="join-game">Join a game (not Working)</button>
      <a href="./host.html"><button type="button" name="join-game">Solo Play</button></a>
    </main>
    <div class="modal-bg">
      <div class="modal-title">
        <h2>Server IP:</h2>
        <button type="button" onclick="closeModal()" name="modal-close" class="modal-close">
          <strong>+</strong>
        </button>
      </div>
      <div class="modal-content">
        <input type="text" name="ip" id="ip" value="localhost:3000">
        <button type="button" onclick="joinGame();" name="confirm" class="modal-confirm">
          <a href="./client.html"><strong>></strong></a>
        </button>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById("ip").addEventListener("keyup", function(e) {
        if (!e)
          e = window.event;
        e.preventDefault();
        if (e.keyCode == 13)
          joinGame();
      });
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = 100;

      let lastEffect = 0;
      const delay = 2000;

      const game = new Game({
        particlesManager: {
          update(ms) {
            if ( lastEffect+Math.random()*delay<ms ) {
              const position ={x: Math.random()*canvas.width, y: Math.random()*canvas.height};
              const color = `rgb(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255})`
              new Particles(position, 20, 1, color);
              lastEffect = performance.now();
            }
          },
          render () {}
        }
      });
      game.run();
    </script>
  </body>
</html>
